(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{532:function(t,e,s){"use strict";s.r(e);var a=s(17),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"exchange-files-between-nodes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#exchange-files-between-nodes"}},[t._v("#")]),t._v(" Exchange files between nodes")]),t._v(" "),s("p",[t._v("This tutorial aims to create a simple application with an IPFS node that dials to other instances using WebRTC, and at the same time, dial and transfer files from a browser IPFS node using WebSockets as the transport.")]),t._v(" "),s("p",[t._v("As "),s("code",[t._v("js-ipfs@0.41.x")]),t._v(" currently doesn't support DHT peer discovery, the peer from which you are fetching data should be within reach (local or in public IP) of the browser node. That being said, we explain how to circumvent these caveats in this tutorial, and once they are fixed, we'll update everything here.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("┌──────────────┐                ┌──────────────┐\n│   Browser    │ libp2p(WebRTC) │   Browser    │\n│              │◀──────────────▶│              │\n└──────────────┘                └──────────────┘\n       ▲                                  ▲\n       │WebSockets              WebSockets│\n       │        ┌──────────────┐          │\n       │        │   Desktop    │          │\n       └───────▶│   Terminal   │◀─────────┘\n                └──────────────┘\n")])])]),s("p",[t._v("Here's what we are going to be doing:")]),t._v(" "),s("ol",[s("li",[t._v("Install an IPFS node in your machine.")]),t._v(" "),s("li",[t._v("Make your daemons listen on WebSockets.")]),t._v(" "),s("li",[t._v("Start a "),s("code",[t._v("libp2p-webrtc-star")]),t._v(" signaling server.")]),t._v(" "),s("li",[t._v("Start the app.")]),t._v(" "),s("li",[t._v("Connect to a node using WebSockets.")]),t._v(" "),s("li",[t._v("Transfer files between all of your nodes!")])]),t._v(" "),s("p",[t._v("At the end of the tutorial you should have something that looks like this:")]),t._v(" "),s("p",[s("img",{attrs:{src:"images/exchange-files-between-nodes/goal.png",alt:"Web browser showing the final product of this tutorial.",loading:"lazy"}})]),t._v(" "),s("h2",{attrs:{id:"prerequisites"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[t._v("#")]),t._v(" Prerequisites")]),t._v(" "),s("p",[t._v("You must have the following installed:")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://nodejs.org/en/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Node.js"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.npmjs.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("NPM"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.npmjs.com/package/bundle-js",target:"_blank",rel:"noopener noreferrer"}},[t._v("Bundle"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"/install"}},[t._v("IPFS")])])]),t._v(" "),s("h2",{attrs:{id:"set-up"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#set-up"}},[t._v("#")]),t._v(" Set up")]),t._v(" "),s("p",[t._v("Before we get stared, you'll need to download the JS-IPFS project repo, install the dependencies, and build the project.")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("Download the project repository:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/ipfs/js-ipfs.git\n")])])])]),t._v(" "),s("li",[s("p",[t._v("Move into the "),s("code",[t._v("js-ipfs")]),t._v(" folder and install the dependencies:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" js-ipfs\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("Build the project:")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run bundle\n")])])])])]),t._v(" "),s("h3",{attrs:{id:"make-your-daemons-listen-on-websockets"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#make-your-daemons-listen-on-websockets"}},[t._v("#")]),t._v(" Make your daemons listen on WebSockets")]),t._v(" "),s("p",[t._v("Now you need to edit your "),s("code",[t._v("config")]),t._v(" file, the one you just set up with "),s("code",[t._v("{js}ipfs init")]),t._v(". It should be in either "),s("code",[t._v("~/.jsipfs/config")]),t._v(" or "),s("code",[t._v("~/.ipfs/config")]),t._v(", depending on whether you're using JS or Go.")]),t._v(" "),s("p",[s("strong",[t._v("Note:")]),t._v(" "),s("code",[t._v("js-ipfs")]),t._v(" sets up a websocket listener by default, so if you're using the JS implementation you can skip this and just start the daemon.")]),t._v(" "),s("p",[t._v("Since websockets support is currently not on by default, you'll need to add a WebSockets address manually. Look into your config file to find the "),s("code",[t._v("Addresses")]),t._v(" section:")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Addresses"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Swarm"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/ip4/0.0.0.0/tcp/4002"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"API"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/ip4/127.0.0.1/tcp/5002"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Gateway"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/ip4/127.0.0.1/tcp/9090"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("Add the "),s("code",[t._v("/ip4/127.0.0.1/tcp/4003/ws")]),t._v(" entry to your "),s("code",[t._v("Swarm")]),t._v(" array. Now it should look like this:")]),t._v(" "),s("div",{staticClass:"language-json extra-class"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Addresses"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Swarm"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/ip4/0.0.0.0/tcp/4002"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/ip4/127.0.0.1/tcp/4003/ws"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"API"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/ip4/127.0.0.1/tcp/5002"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"Gateway"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/ip4/127.0.0.1/tcp/9090"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("Save the file and it should be able to listen on Websockets. We're ready to start the daemon.")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ipfs daemon\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" jsipfs daemon\n")])])]),s("p",[t._v("You should see the Websocket address in the output:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("Initializing daemon"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\nSwarm listening on /ip4/127.0.0.1/tcp/4001\nSwarm listening on /ip4/127.0.0.1/tcp/4003/ws\nSwarm listening on /ip4/192.168.10.38/tcp/4001\nSwarm listening on /ip4/192.168.10.38/tcp/4003/ws\nAPI server listening on /ip4/127.0.0.1/tcp/5001\nGateway "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("readonly"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" server listening on /ip4/0.0.0.0/tcp/8080\nDaemon is ready\n")])])]),s("p",[t._v("Check the "),s("code",[t._v("/ws")]),t._v(" in line 5, that means it is listening. Cool.")]),t._v(" "),s("h3",{attrs:{id:"_3-start-the-app"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-start-the-app"}},[t._v("#")]),t._v(" 3. Start the app")]),t._v(" "),s("p",[t._v("Make sure you're in "),s("code",[t._v("js-ipfs/examples/exchange-files-in-browser")]),t._v(".")]),t._v(" "),s("p",[t._v("We'll need to bundle the dependencies to run the app. Let's do it:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" run bundle\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" start\n")])])]),s("p",[t._v("You should see something like this if all went well:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[t._v("Starting up http-server, serving public\nAvailable on:\n  http://127.0.0.1:12345\n  http://192.168.2.92:12345\nHit CTRL-C to stop the server\n")])])]),s("p",[t._v("Now go to http://127.0.0.1:12345 in a modern browser and you're on!")]),t._v(" "),s("h3",{attrs:{id:"_4-dial-to-a-node-using-websockets-your-desktop-ones"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-dial-to-a-node-using-websockets-your-desktop-ones"}},[t._v("#")]),t._v(" 4. Dial to a node using WebSockets (your desktop ones)")]),t._v(" "),s("p",[t._v("Make sure you have a daemon running. If you don't, run:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ipfs daemon\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" jsipfs daemon\n")])])]),s("p",[t._v("Open another terminal window to find the websocket addresses that it is listening on:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ipfs "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" jsipfs "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v("\n")])])]),s("p",[t._v("It should look like this: "),s("code",[t._v("/ip4/127.0.0.1/tcp/4003/ws/ipfs/<your_peer_id>")]),t._v(".")]),t._v(" "),s("p",[t._v("Copy and paste the "),s("em",[t._v("multiaddr")]),t._v(" to connect to that peer:")]),t._v(" "),s("p",[s("img",{attrs:{src:"img/connect-1.png",alt:"",loading:"lazy"}})]),t._v(" "),s("p",[t._v("Check that you got connected:")]),t._v(" "),s("p",[s("img",{attrs:{src:"img/connect-2.png",alt:"",loading:"lazy"}})]),t._v(" "),s("blockquote",[s("p",[t._v("It only works on localhost environments because of a restriction with WebCrypto where it will not load in a page unless that page is loaded over https, or the page is served from localhost: "),s("a",{attrs:{href:"https://github.com/libp2p/js-libp2p-crypto/issues/105",target:"_blank",rel:"noopener noreferrer"}},[t._v("libp2p/js-libp2p-crypto#105"),s("OutboundLink")],1)])]),t._v(" "),s("h3",{attrs:{id:"_5-transfer-files-between-all-of-your-nodes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-transfer-files-between-all-of-your-nodes"}},[t._v("#")]),t._v(" 5. Transfer files between all of your nodes!")]),t._v(" "),s("p",[t._v("Now you can add files through the CLI with:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" ipfs "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("file"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" jsipfs "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("file"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("p",[t._v("Copy and paste the "),s("em",[t._v("multihash")]),t._v(" and fetch the file in the browser!")]),t._v(" "),s("p",[s("img",{attrs:{src:"img/fetch.png",alt:"",loading:"lazy"}})]),t._v(" "),s("p",[t._v("You can also open two browser tabs, drag and drop files in one of them, and fetch them in the other!")]),t._v(" "),s("p",[t._v("But the coolest thing about this tutorial is "),s("code",[t._v("pubsub")]),t._v("! You can open two tabs that will share files through workspaces named after the url. Try opening two tabs with the following url:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("http://127.0.0.1:12345/#file-exchange\n# You can substitute `file-exchange` with anything you like, just make sure the two tabs are in the same workspace.\n")])])]),s("p",[t._v("Now every file that you upload in one tab will appear in the other! You can even open a new tab in that workspace and it will sync the files that were added before!")]),t._v(" "),s("p",[s("img",{attrs:{src:"img/pubsub.png",alt:"",loading:"lazy"}})]),t._v(" "),s("h2",{attrs:{id:"going-to-production"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#going-to-production"}},[t._v("#")]),t._v(" Going to production?")]),t._v(" "),s("p",[t._v("This example uses public webrtc-star servers. These servers should be used for experimenting and demos, they "),s("strong",[t._v("MUST")]),t._v(" not be used in production as there is no guarantee on availability.")]),t._v(" "),s("h3",{attrs:{id:"use-your-own-libp2p-webrtc-star-signaling-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#use-your-own-libp2p-webrtc-star-signaling-server"}},[t._v("#")]),t._v(" Use your own "),s("code",[t._v("libp2p-webrtc-star")]),t._v(" signaling server")]),t._v(" "),s("p",[t._v("This server allows the two browser nodes to talk to each other by doing the initial handshake and network introductions.")]),t._v(" "),s("p",[t._v("First install the "),s("code",[t._v("libp2p-webrtc-star")]),t._v(" module globally:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" -g libp2p-webrtc-star\n")])])]),s("p",[t._v("This will give you the "),s("code",[t._v("webrtc-star")]),t._v(" command. Use this to start a signaling server:")]),t._v(" "),s("div",{staticClass:"language-sh extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sh"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" webrtc-star\n")])])]),s("p",[t._v("By default it will listen to all incoming connections on port 13579. Override this with the "),s("code",[t._v("--host")]),t._v(" and/or "),s("code",[t._v("--port")]),t._v(" options. That is, the following multiaddr: "),s("code",[t._v("/ip4/127.0.0.1/tcp/13579/wss/p2p-webrtc-star")]),t._v(".")]),t._v(" "),s("p",[t._v("You should add your signaling server in the IPFS config swarm addresses, so that you listen for new connections through it.")])])}),[],!1,null,null,null);e.default=n.exports}}]);