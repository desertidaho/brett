
¸¸®¸ecInfoUrl",value:a.DataType.string},2536e3:{name:"codecDownloadUrl",value:a.DataType.string},170:{name:"codecDecodeAll",value:a.DataType.bool},28587:{name:"trackOverlay",value:a.DataType.uint},224:{name:"video",container:{154:{name:"flagInterlaced",value:a.DataType.bool},21432:{name:"stereoMode",value:a.DataType.uint},176:{name:"pixelWidth",value:a.DataType.uint},186:{name:"pixelHeight",value:a.DataType.uint},21680:{name:"displayWidth",value:a.DataType.uint},21690:{name:"displayHeight",value:a.DataType.uint},21683:{name:"aspectRatioType",value:a.DataType.uint},3061028:{name:"colourSpace",value:a.DataType.uint},3126563:{name:"gammaValue",value:a.DataType.float}}},225:{name:"audio",container:{181:{name:"samplingFrequency",value:a.DataType.float},30901:{name:"outputSamplingFrequency",value:a.DataType.float},159:{name:"channels",value:a.DataType.uint},148:{name:"channels",value:a.DataType.uint},32123:{name:"channelPositions",value:a.DataType.binary},25188:{name:"bitDepth",value:a.DataType.uint}}},28032:{name:"contentEncodings",container:{25152:{name:"contentEncoding",container:{20529:{name:"order",value:a.DataType.uint},20530:{name:"scope",value:a.DataType.bool},20531:{name:"type",value:a.DataType.uint},20532:{name:"contentEncoding",container:{16980:{name:"contentCompAlgo",value:a.DataType.uint},16981:{name:"contentCompSettings",value:a.DataType.binary}}},20533:{name:"contentEncoding",container:{18401:{name:"contentEncAlgo",value:a.DataType.uint},18402:{name:"contentEncKeyID",value:a.DataType.binary},18403:{name:"contentSignature ",value:a.DataType.binary},18404:{name:"ContentSigKeyID  ",value:a.DataType.binary},18405:{name:"contentSigAlgo ",value:a.DataType.uint},18406:{name:"contentSigHashAlgo ",value:a.DataType.uint}}},25188:{name:"bitDepth",value:a.DataType.uint}}}}}}}}},475249515:{name:"cues",container:{187:{name:"cuePoint",container:{179:{name:"cueTime",value:a.DataType.uid},183:{name:"positions",container:{247:{name:"track",value:a.DataType.uint},241:{name:"clusterPosition",value:a.DataType.uint},21368:{name:"blockNumber",value:a.DataType.uint},234:{name:"codecState",value:a.DataType.uint},219:{name:"reference",container:{150:{name:"time",value:a.DataType.uint},151:{name:"cluster",value:a.DataType.uint},21343:{name:"number",value:a.DataType.uint},235:{name:"codecState",value:a.DataType.uint}}},240:{name:"relativePosition",value:a.DataType.uint}}}}}}},423732329:{name:"attachments",container:{24999:{name:"attachedFiles",multiple:!0,container:{18046:{name:"description",value:a.DataType.string},18030:{name:"name",value:a.DataType.string},18016:{name:"mimeType",value:a.DataType.string},18012:{name:"data",value:a.DataType.binary},18094:{name:"uid",value:a.DataType.uid}}}}},272869232:{name:"chapters",container:{17849:{name:"editionEntry",container:{182:{name:"chapterAtom",container:{29636:{name:"uid",value:a.DataType.uid},145:{name:"timeStart",value:a.DataType.uint},146:{name:"timeEnd",value:a.DataType.uid},152:{name:"hidden",value:a.DataType.bool},17816:{name:"enabled",value:a.DataType.uid},143:{name:"track",container:{137:{name:"trackNumber",value:a.DataType.uid},128:{name:"display",container:{133:{name:"string",value:a.DataType.string},17276:{name:"language ",value:a.DataType.string},17278:{name:"country ",value:a.DataType.string}}}}}}}}}}},307544935:{name:"tags",container:{29555:{name:"tag",multiple:!0,container:{25536:{name:"target",container:{25541:{name:"tagTrackUID",value:a.DataType.uid},25540:{name:"tagChapterUID",value:a.DataType.uint},25542:{name:"tagAttachmentUID",value:a.DataType.uid},25546:{name:"targetType",value:a.DataType.string},26826:{name:"targetTypeValue",value:a.DataType.uint},25545:{name:"tagEditionUID",value:a.DataType.uid}}},26568:{name:"simpleTags",multiple:!0,container:{17827:{name:"name",value:a.DataType.string},17543:{name:"string",value:a.DataType.string},17541:{name:"binary",value:a.DataType.binary},17530:{name:"language",value:a.DataType.string},17531:{name:"languageIETF",value:a.DataType.string},17540:{name:"default",value:a.DataType.bool}}}}}}}}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RandomBufferReader=class{constructor(e){this.buf=e,this.fileSize=e.length}async randomRead(e,t,r,a){return this.buf.copy(e,t,a,a+r)}}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.endTag2="LYRICS200",t.getLyricsHeaderLength=async function(r){if(r.fileSize>=143){const a=e.alloc(15);await r.randomRead(a,0,a.length,r.fileSize-143);const n=a.toString("binary");if(n.substr(6)===t.endTag2)return parseInt(n.substr(0,6),10)+15}return 0}}).call(this,r(2).Buffer)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(36);class n extends a.Readable{constructor(e){super(),this.bytesRead=0,this.released=!1,this.reader=e.getReader()}async _read(){if(this.released)return void this.push(null);this.pendingRead=this.reader.read();const e=await this.pendingRead;delete this.pendingRead,e.done||this.released?this.push(null):(this.bytesRead+=e.value.length,this.push(e.value))}async waitForReadToComplete(){this.pendingRead&&await this.pendingRead}async close(){await this.syncAndRelease()}async syncAndRelease(){this.released=!0,await this.waitForReadToComplete(),await this.reader.releaseLock()}}t.ReadableWebToNodeStream=n},function(e,t,r){(function(t){var a=r(130).strict;e.exports=function(e){if(a(e)){var r=t.from(e.buffer);return e.byteLength!==e.buffer.byteLength&&(r=r.slice(e.byteOffset,e.byteOffset+e.byteLength)),r}return t.from(e)}}).call(this,r(2).Buffer)},function(e,t){e.exports=n,n.strict=i,n.loose=s;var r=Object.prototype.toString,a={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function n(e){return i(e)||s(e)}function i(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}function s(e){return a[r.call(e)]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(1),n=r(132),i=r(47),s=a("streaming-http-token-reader:http-client");class o{constructor(e){this.url=e}static getContentLength(e){const t=e.get("Content-Length");return t?parseInt(t,10):void 0}static parseContentRange(e){const t=e.get("Content-Range");return i.parseContentRange(t)}static makeResponse(e){const t=o.parseContentRange(e.headers);return{url:e.url,size:t?t.instanceLength:o.getContentLength(e.headers),mimeType:e.headers.get("Content-Type"),contentRange:t,arrayBuffer:()=>e.arrayBuffer()}}async getHeadInfo(){const e=await n(this.url,{method:"HEAD"});return this.resolvedUrl=e.url,o.makeResponse(e)}async getResponse(e,t){s(t?`_getResponse ${e} ${t[0]}..${t[1]}`:`_getResponse ${e} (range not provided)`);const r=new n.Headers;r.set("Range","bytes="+t[0]+"-"+t[1]);const a=await n(this.resolvedUrl||this.url,{method:e,headers:r});if(a.ok)return this.resolvedUrl=a.url,o.makeResponse(a);throw new Error(`Unexpected HTTP response status=${a.status}`)}}t.HttpClient=o},function(e,t,r){"use strict";var a=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==a)return a;throw new Error("unable to locate global object")}();e.exports=t=a.fetch,t.default=a.fetch.bind(a),t.Headers=a.Headers,t.Request=a.Request,t.Response=a.Response},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=r(48),n=r(1)("range-request-reader");t.RangeRequestFactory=class{constructor(e){this.rangeRequestClient=e,this.config={avoidHeadRequests:!1,initialChunkSize:4096,minimumChunkSize:1024}}async initTokenizer(e){e&&(this.config=Object.assign(Object.assign({},this.config),e));const t=await this.getHeadRequestInfo();return new a.RangeRequestTokenizer(this.rangeRequestClient,t,this.config.minimumChunkSize)}getHeadRequestInfo(){return this.config.avoidHeadRequests?this.fetchFileInfoWithGetRequest():this.fetchFileInfoWithHeadRequest()}async fetchFileInfoWithHeadRequest(){n("_fetchSizeWithHeadRequest()");const e=await this.rangeRequestClient.getHeadInfo();return e.size?(n(`MIME-type=${e.mimeType}, content-length=${e.size}`),e):(n("Content-Length not provided by the server, fallback to GET requests"),this.fetchFileInfoWithGetRequest())}async fetchFileInfoWithGetRequest(){const e=a.roundRange([0,this.config.initialChunkSize],this.config.minimumChunkSize),t=await this.rangeRequestClient.getResponse("GET",e);if(n(`_fetchSizeWithGetRequest response: contentRange=${t.contentRange}`),!t.contentRange)throw new Error("Failed to resolve content range (file size)");return t}}},function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});const r=-1;t.ChunkedFileData=class{constructor(){this._fileData=[]}addData(e,t){const a=e+t.byteLength-1,n=this._getChunkRange(e,a);if(n.startIx===r)this._fileData.splice(n.insertIx||0,0,{offset:e,data:t});else{const r=this._fileData[n.startIx],i=this._fileData[n.endIx],s=e>r.offset,o=a<i.offset+i.data.byteLength-1,c={offset:Math.min(e,r.offset),data:t};if(s){const a=r.data.slice(0,e-r.offset);c.data=this._concatData(a,t)}if(o){const e=c.data.slice(0,i.offset-c.offset);c.data=this._concatData(e,i.data)}this._fileData.splice(n.startIx,n.endIx-n.startIx+1,c)}}hasDataRange(e,t){for(let r=0;r<this._fileData.length;r++){const a=this._fileData[r];if(t<a.offset)return!1;if(e>=a.offset&&t<a.offset+a.data.byteLength)return!0}return!1}readToBuffer(t,r,a,n){const i=a;let s;for(let o=0;o<this._fileData.length;o++){const c=this._fileData[o].offset,u=c+this._fileData[o].data.byteLength-1;if(i>=c&&i<=u){s=this._fileData[o];const u=i-c,l=Math.min(n,s.data.byteLength-u);return e.from(s.data).copy(t,r,u,u+l),l<n?this.readToBuffer(t,r+l,a+l,n-l):void 0}}throw new Error(`Offset ${i} hasn't been loaded yet.`)}_concatData(e,t){const r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r.buffer}_getChunkRange(e,t){let a=r,n=r,i=0;for(let r=0;r<this._fileData.length;i=++r){const n=this._fileData[r].offset,i=n+this._fileData[r].data.byteLength;if(t<n-1)break;if(e<=i+1&&t>=n-1){a=r;break}}if(a===r)return{startIx:r,endIx:r,insertIx:i};for(let e=a;e<this._fileData.length;e++){const r=this._fileData[e].offset;if(t>=r-1&&(n=e),t<=r+this._fileData[e].data.byteLength+1)break}return n===r&&(n=a),{startIx:a,endIx:n}}}}).call(this,r(2).Buffer)},function(e,t,r){"use strict";r.r(t),self.importScripts&&importScripts("version.js");const a=self.indexedDB||self.webkitIndexedDB||self.mozIndexedDB||self.msIndexedDB,n={main:"main",tracks:"tracks"};let i,s,o=0;function c(e){return!i&&o<20?(o++,new Promise((t,r)=>{setTimeout(()=>{c(e).then(t,r)},250)})):(o=0,new Promise((t,r)=>{const a=e.store||n.main,s=e.key,o=i.transaction([a],"readwrite").objectStore(a).get(s);o.onsuccess=e=>{o.result?t(o.result):t(null)},o.onerror=r}))}function u(e){return new Promise((t,r)=>{const a=e.store||n.main,s=e.key,o=e.data,c=i.transaction([a],"readwrite").objectStore(a).put(o,s);c.onsuccess=t,c.onerror=r})}function l(e){return new Promise((t,r)=>{const a=e.store||n.main,s=e.key,o=i.transaction([a],"readwrite").objectStore(a).delete(s);o.onsuccess=t,o.onerror=r})}(s=a.open("diffuse",1)).onupgradeneeded=e=>{e.target.result.createObjectStore(n.main),e.target.result.createObjectStore(n.tracks)},s.onsuccess=e=>{i=s.result,u({key:"VERSION",data:self.VERSION})},s.onerror=e=>{console.error("IndexedDB error: "+e.target.error)};var d=r(29),f=r(49);function p(e){return e}function h(e){const t=e.split("://");switch(t[0]){case"dropbox":{const e=t[1].split("@"),r=e[0],a=e[1];return fetch("https://api.dropboxapi.com/2/files/get_temporary_link",{method:"POST",body:JSON.stringify({path:a}),headers:new Headers({Authorization:"Bearer "+r,"Content-Type":"application/json"})}).then(e=>e.json()).then(e=>e.link)}default:return Promise.resolve(e)}}function m(e){const t=Promise.resolve([]);return e.urlsForTags.reduce((t,r,a)=>t.then(t=>{const n=e.receivedFilePaths[a].split("/").reverse()[0];return Promise.all([h(r.headUrl),h(r.getUrl)]).then(([e,t])=>(function(e,t,r){const a=r.match(/\.(\w+)$/),n=a&&a[1],i=t.includes("googleapis.com")||t.includes("googleusercontent.com");return Object(f.makeTokenizer)(e).then(e=>{const r=i?function(e){switch(e){case"mp3":return"audio/mpeg";case"mp4":case"m4a":return"audio/mp4";case"flac":return"audio/flac";case"ogg":return"audio/ogg";case"wav":return"audio/wave";case"webm":return"audio/webm"}}(n):e.fileInfo.mimeType;e.fileInfo.mimeType=r,e.fileInfo.url=t,e.rangeRequestClient.url=t,e.rangeRequestClient.resolvedUrl=void 0;const a=e.rangeRequestClient.getResponse;return e.rangeRequestClient.getResponse=function(){return this.resolvedUrl=t,a.apply(this,arguments)},d.parseFromTokenizer(e,g)}).then(y).catch(e=>(console.error(e),function(e){return{disc:1,nr:1,album:"Unknown",artist:"Unknown",title:e.replace(/\.\w+$/,""),genre:null,year:null,picture:null}}(r)))})(e,t,n)).then(e=>t.concat(e)).catch(e=>(console.error(e),t.concat(null)))}),t).then(t=>(e.receivedTags=t,e))}const g=Object.assign({},d.parsingOptions,{duration:!1,skipCovers:!0,skipPostHeaders:!0});function y(e){const t=e&&e.common;return t?{disc:t.disk.no||1,nr:t.track.no||1,album:t.album&&t.album.length?t.album:"Unknown",artist:t.artist&&t.artist.length?t.artist:"Unknown",title:t.title&&t.title.length?t.title:"Unknown",genre:t.genre&&t.genre[0]||null,year:t.year||null,picture:null}:null}const b=self.crypto||self.msCrypto,T=!1;function k(e){const t=new Uint8Array(e);let r="";for(let e=0;e<t.byteLength;e++)r+=String.fromCharCode(t[e]);return self.btoa(r)}function w(e){return new TextDecoder("UTF-8").decode(e)}function v(e){const t=self.atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r.buffer}function I(e){return new TextEncoder("UTF-8").encode(e).buffer}const S={name:"Diffuse",pin:!0,mill:"/blob",plaintext:!1},E={activeThreadId:void 0,deleteBlock:(e,t)=>fetch(e+"/api/v0/blocks/"+t.block,{method:"DELETE"}).then(e=>e.json()),ensureThread:e=>E.activeThreadId?Promise.resolve(E.activeThreadId):E.getThread(e).then(t=>t||E.createSchema(e).then(t=>E.createThread(e,t))).then(e=>(E.activeThreadId=e.id,e.id)),getThread:e=>fetch(e+"/api/v0/threads").then(e=>e.json()).then(e=>e.items.find(e=>"Diffuse"===e.name)),createThread:(e,t)=>{const r=new Headers;return r.append("X-Textile-Args","Diffuse"),r.append("X-Textile-Opts","schema="+t.hash+",type=private,sharing=invite_only"),fetch(e+"/api/v0/threads",{headers:r,method:"POST"}).then(e=>e.json())},addFileToThread:(e,t)=>{const r=new Headers;r.append("Content-Type","application/json");const a={};return a[":single"]=t,fetch(e+"/api/v0/threads/"+E.activeThreadId+"/files",{body:JSON.stringify({items:[{files:a}]}),headers:r,method:"POST"}).then(e=>e.json())},getFile:(e,t)=>{const r=new Headers;return r.append("X-Textile-Opts","thread="+E.activeThreadId),fetch(e+"/api/v0/files",{headers:r,method:"GET"}).then(e=>e.json()).then(e=>e.items.find(e=>e.files[0].file.name===t))},readFile:(e,t)=>{const r=new Headers;return r.append("X-Textile-Opts","key="+t.files[0].file.key),fetch(e+"/api/v0/ipfs/cat/"+t.files[0].file.hash,{headers:r,method:"GET"}).then(e=>e.text())},createSchema:e=>{const t=new Headers;return t.append("Content-Type","application/json"),fetch(e+"/api/v0/mills/schema",{body:JSON.stringify(S),headers:t,method:"POST"}).then(e=>e.json())},useMill:(e,t,r)=>{const a=new Blob([r],{type:"application/json"}),n=new File([a],t),i=new FormData;return i.append("file",n),(new Headers).append("X-Textile-Opts","plaintext=false"),fetch(e+"/api/v0/mills/blob",{body:i,method:"POST"}).then(e=>e.json())}};var _=E;const C="AUTH_SECRET_KEY";function A(e){return e.startsWith("AUTH_")&&"AUTH_BLOCKSTACK_SESSION"!==e&&"AUTH_ENCLOSED_DATA"!==e&&"AUTH_METHOD"!==e&&"AUTH_SECRET_KEY"!==e}function B(e,t){return r=>{const a=r?r.message||r:null;a&&(console.error(a,r.stack),e.ports.fromAlien.send({tag:t.tag,data:null,error:a}))}}function P(e,t,r){return a=>{e.ports.fromAlien.send({tag:t.tag,data:r&&r.parseJSON&&"string"==typeof a?JSON.parse(a):a||null,error:null})}}function x(e,t){return P(e,t,{parseJSON:!0})}function D(e,t){return t=>{e.ports.savedHypaethralBit.send()}}function O(e){return l({key:e})}function M(e){return A(e)?c({key:e}).then(F).then(e=>"string"==typeof e?JSON.parse(e):e).then(e=>void 0===e?null:e):c({key:e})}function R(e,t){if(A(e)){return z(JSON.stringify(t)).then(t=>u({key:e,data:t}))}return u({key:e,data:t})}function F(e){return"string"!=typeof e?Promise.resolve(e):e.startsWith("{")||e.startsWith("[")?Promise.resolve(e):e?L().then(t=>(function(e,t){const r=t.substring(0,16),a=t.substring(16),n=v(r),i=v(a);return b.subtle.decrypt({name:"AES-GCM",iv:n,tagLength:128},e,i).then(w)})(t,e)):Promise.resolve(null)}function z(e){return e?L().then(t=>(function(e,t){let r=b.getRandomValues(new Uint8Array(12));return b.subtle.encrypt({name:"AES-GCM",iv:r,tagLength:128},e,I(t)).then(e=>{return k(r)+k(e)})})(t,e)).catch(t=>e):null}function L(){return c({key:C}).then(e=>e||Promise.reject(new Error("MISSING_SECRET_KEY")))}const N=[];let U;function j(){return U||(importScripts("vendor/blockstack.min.js"),U=new blockstack.UserSession({appConfig:new blockstack.AppConfig({appDomain:location.origin}),sessionStore:H})),U}N.fabricateSecretKey=e=>t=>{(function(e){return b.subtle.importKey("raw",I(e),{name:"PBKDF2"},!1,["deriveKey"]).then(e=>b.subtle.deriveKey({name:"PBKDF2",salt:I("diffuse"),iterations:1e4,hash:"SHA-512"},e,{name:"AES-GCM",length:256},T,["encrypt","decrypt"]))})(t.data).then(e=>R(C,e)).then(r=>{e.ports.fromAlien.send({tag:t.tag,data:null,error:null})}).catch(B(e,t))};const H={key:"AUTH_BLOCKSTACK_SESSION",getSessionData(){return M(this.key).then(e=>e||{})},setSessionData(e){return R(this.key,e)},deleteSessionData(){return O(this.key)}};N.deconstructBlockstack=e=>e=>{H.deleteSessionData(),U=null},N.handlePendingBlockstackSignIn=e=>t=>{j().handlePendingSignIn(t).then(t=>{e.ports.fromAlien.send({tag:"SIGN_IN",data:{method:"BLOCKSTACK",passphrase:null},error:null})}).catch(B({tag:"AUTH_BLOCKSTACK"}))},N.redirectToBlockstackSignIn=e=>t=>{const r=j();r.generateAndStoreTransitKey().then(e=>{const t=location.pathname.replace("brain.js","");return r.makeAuthRequest(e,location.origin+t+"?action=authenticate/blockstack",location.origin+t+"manifest.json",["store_write"])}).then(e=>{self.postMessage({action:"REDIRECT_TO_BLOCKSTACK",data:e})}).catch(B(e,t))},N.requestBlockstack=e=>t=>{j().getFile(t.data.file).then(x(e,t)).catch(B(e,t))},N.toBlockstack=e=>t=>{const r=JSON.stringify(t.data.data);j().putFile(t.data.file,r).then(D(e)).catch(B(e,t))},N.requestDropbox=e=>t=>{const r={path:"/"+t.data.file};(navigator.onLine?fetch("https://content.dropboxapi.com/2/files/download",{method:"POST",headers:{Authorization:"Bearer "+t.data.token,"Dropbox-API-Arg":JSON.stringify(r)}}).then(e=>e.ok?e.text():e.json()).then(e=>e.error?null:e).then(F):M(t.tag+"_"+t.data.file)).then(x(e,t)).catch(B(e,t))},N.toDropbox=e=>t=>{const r=JSON.stringify(t.data.data),a=B(e,t),n={path:"/"+t.data.file,mode:"overwrite",mute:!0};navigator.onLine&&z(r).then(e=>fetch("https://content.dropboxapi.com/2/files/upload",{method:"POST",headers:{Authorization:"Bearer "+t.data.token,"Content-Type":"application/octet-stream","Dropbox-API-Arg":JSON.stringify(n)},body:e})).then(D(e)).catch(a),R(t.tag+"_"+t.data.file,t.data.data).then(navigator.onLine?p:D(e)).catch(a)};let q,W;function $(e){return q?Promise.resolve():(importScripts("vendor/remotestorage.min.js"),(q=new RemoteStorage({cache:!1})).access.claim("diffuse","rw"),W=q.scope("/diffuse/"),new Promise(t=>{q.on("connected",t),q.connect(e.data.userAddress,e.data.token)}))}function G(e){return!(navigator.onLine||(t=e.data.userAddress.replace(/^[^@]*@/,""),t.startsWith("localhost")||t.startsWith("localhost")||t.startsWith("127.0.0.1")||t.startsWith("127.0.0.1")));var t}N.requestIpfs=e=>t=>{const r=t.data.apiOrigin,a="/Applications/Diffuse/"+t.data.file;fetch(r+"/api/v0/files/read?arg="+a,{method:"POST"}).then(e=>e.ok?e.text():e.json()).then(e=>0===e.Code?null:e).then(F).then(x(e,t)).catch(B(e,t))},N.toIpfs=e=>t=>{const r=t.data.apiOrigin,a=JSON.stringify(t.data.data),n=new URLSearchParams({arg:"/Applications/Diffuse/"+t.data.file,create:!0,offset:0,parents:!0,truncate:!0}).toString();z(a).then(e=>{const t=new FormData;return t.append("data",e),fetch(r+"/api/v0/files/write?"+n,{method:"POST",body:t})}).then(D(e)).catch(B(e,t))},N.requestLegacyLocalData=e=>t=>{let r,a=location.hostname+".json";(r=indexedDB.open(a,1)).onsuccess=n=>{const i=r.result.transaction([a],"readwrite").objectStore(a).get(a);i.onsuccess=r=>{i.result&&x(e,t)(i.result)}}},N.deconstructRemoteStorage=e=>e=>{q=null,W=null},N.requestRemoteStorage=e=>t=>{(G(t)?M(t.tag+"_"+t.data.file):$(t).then(e=>W.getFile(t.data.file)).then(e=>e.data).then(F)).then(x(e,t)).catch(B(e,t))},N.toRemoteStorage=e=>t=>{const r=JSON.stringify(t.data.data),a=G(t);!a&&$(t).then(e=>z(r)).then(e=>W.storeFile("application/json",t.data.file,e)).then(D(e)).catch(B(e,t)),R(t.tag+"_"+t.data.file,t.data.data).then(a?D(e):p).catch(B(e,t))},N.requestTextile=e=>t=>{const r=t.data.apiOrigin;_.ensureThread(r).then(e=>_.getFile(r,t.data.file)).then(e=>e?_.readFile(r,e):null).then(x(e,t)).catch(B(e,t))},N.toTextile=e=>t=>{const r=t.data.apiOrigin,a=JSON.stringify(t.data.data);_.ensureThread(r).then(e=>_.getFile(r)).then(e=>e?_.deleteBlock(r,e):null).then(e=>_.useMill(r,t.data.file,a)).then(e=>_.addFileToThread(r,e)).then(D(e)).catch(B(e,t))},importScripts("brain.elm.js"),importScripts("subworkers.js");const X=location.hash.substr(1).split("&").reduce((e,t)=>{const[r,a]=t.split("=");return{...e,[r]:a}},{}),V=Elm.Brain.init({flags:{initialUrl:decodeURIComponent(X.appHref)||""}});var Y;Y=V,Object.keys(N).forEach(e=>{const t=N[e](Y);Y.ports[e].subscribe(t)}),self.onmessage=e=>{if(e.data.tag)return V.ports.fromAlien.send(e.data)},V.ports.toUI.subscribe(e=>{self.postMessage(e)}),V.ports.removeCache.subscribe(e=>{O(e.tag).catch(B(V,e))}),V.ports.requestCache.subscribe(e=>{M(e.data&&e.data.file?e.tag+"_"+e.data.file:e.tag).then(P(V,e)).catch(B(V,e))}),V.ports.toCache.subscribe(e=>{R(e.data&&e.data.file?e.tag+"_"+e.data.file:e.tag,e.data.data||e.data).then(D(V)).catch(B(V,e))}),V.ports.removeTracksFromCache.subscribe(e=>{e.reduce((e,t)=>e.then(e=>l({key:t,store:n.tracks})),Promise.resolve()).catch(e=>B({tag:"REMOVE_TRACKS_FROM_CACHE"})("Failed to remove tracks from cache"))}),V.ports.storeTracksInCache.subscribe(e=>{e.reduce((e,t)=>e.then(e=>fetch(t.url)).then(e=>e.blob()).then(e=>u({key:t.trackId,data:e,store:n.tracks})),Promise.resolve()).then(t=>self.postMessage({tag:"STORE_TRACKS_IN_CACHE",data:e.map(e=>e.trackId),error:null})).catch(t=>{console.error(t),self.postMessage({tag:"STORE_TRACKS_IN_CACHE",data:e.map(e=>e.trackId),error:t.message||t})})}),V.ports.downloadTracks.subscribe(e=>{self.postMessage({action:"DOWNLOAD_TRACKS",data:e})});const K=new Worker("search.js");V.ports.requestSearch.subscribe(e=>{K.postMessage({action:"PERFORM_SEARCH",data:e})}),V.ports.updateSearchIndex.subscribe(e=>{K.postMessage({action:"UPDATE_SEARCH_INDEX",data:e})}),K.onmessage=e=>{switch(e.data.action){case"PERFORM_SEARCH":V.ports.receiveSearchResults.send(e.data.data)}},V.ports.requestTags.subscribe(e=>{m(e).then(e=>{V.ports.receiveTags.send(e)})})}]);®¸